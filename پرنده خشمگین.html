<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>پرندگان خشمگین - نسخه تخریب</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #87CEEB;
            font-family: 'Tahoma', sans-serif;
            touch-action: none;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #game-info {
            position: absolute;
            top: 20px;
            left: 20px;
            pointer-events: none;
            color: #333;
            z-index: 10;
            text-align: left;
        }

        h1 { margin: 0; font-size: 1.5rem; color: #d32f2f; text-shadow: 2px 2px 0px white; }
        
        #reset-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: #ff9800;
            border: 2px solid white;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #e65100;
            z-index: 100;
            font-family: 'Tahoma';
        }
    </style>
</head>
<body>

    <div id="game-info">
        <h1>حالت تخریب</h1>
        <p>توپ سبز حذف شد + تخریب بالا!</p>
    </div>

    <button id="reset-btn" onclick="initGame()">شروع مجدد</button>

    <script>
        const CONFIG = {
            birdSize: 20,
            birdColor: '#d32f2f',
            boxSize: 40,
            slingshotX: 200,
            slingshotY: 400,
            stiffness: 0.05
        };

        const Engine = Matter.Engine,
              Render = Matter.Render,
              Runner = Matter.Runner,
              Composites = Matter.Composites,
              Events = Matter.Events,
              Constraint = Matter.Constraint,
              MouseConstraint = Matter.MouseConstraint,
              Mouse = Matter.Mouse,
              World = Matter.World,
              Bodies = Matter.Bodies;

        let engine, render, runner, bird, sling;
        let isFired = false;

        function initGame() {
            if (render) {
                Render.stop(render);
                Runner.stop(runner);
                if (render.canvas) render.canvas.remove();
            }

            // فعال‌سازی حالت خواب برای جلوگیری از ریزش اولیه
            engine = Engine.create({
                enableSleeping: true 
            });
            const world = engine.world;

            const width = window.innerWidth;
            const height = window.innerHeight;

            render = Render.create({
                element: document.body,
                engine: engine,
                options: {
                    width: width,
                    height: height,
                    wireframes: false,
                    background: '#87CEEB',
                    showSleeping: false
                }
            });

            const ground = Bodies.rectangle(width / 2, height - 20, width, 60, { 
                isStatic: true, render: { fillStyle: '#795548' } 
            });
            
            const platform = Bodies.rectangle(CONFIG.slingshotX, CONFIG.slingshotY + 80, 20, 160, {
                isStatic: true, render: { fillStyle: '#5D4037' }
            });

            // *** تغییر 1: پرنده بسیار سنگین (مثل گلوله توپ) ***
            bird = Bodies.circle(CONFIG.slingshotX, CONFIG.slingshotY, CONFIG.birdSize, { 
                density: 0.02, // چگالی بسیار بالا (قبلاً 0.004 بود)
                restitution: 0.5,
                render: { fillStyle: CONFIG.birdColor }
            });

            sling = Constraint.create({
                pointA: { x: CONFIG.slingshotX, y: CONFIG.slingshotY },
                bodyB: bird,
                stiffness: CONFIG.stiffness,
                length: 1,
                render: { visible: true, lineWidth: 5, strokeStyle: '#3e2723' }
            });

            const targetX = width - (width > 600 ? 300 : 150);
            const targetY = height - 50;

            // *** تغییر 2: جعبه‌های سبک و لیز برای تخریب راحت ***
            const pyramid = Composites.pyramid(targetX - 100, targetY - 300, 5, 6, 0, 0, function(x, y) {
                return Bodies.rectangle(x, y, CONFIG.boxSize, CONFIG.boxSize, {
                    density: 0.001, // سبک (راحت پرت می‌شوند)
                    friction: 0.05, // بسیار لیز (راحت روی هم می‌لغزند و می‌ریزند)
                    restitution: 0.4, // کمی پرش دار
                    render: { fillStyle: '#ffcc80', strokeStyle: '#e65100', lineWidth: 2 }
                });
            });

            // *** تغییر 3: حذف کدهای مربوط به خوک‌ها (pig) ***
            
            // اضافه کردن به جهان (بدون خوک)
            World.add(world, [ground, platform, bird, sling, pyramid]);

            const mouse = Mouse.create(render.canvas);
            const mouseConstraint = MouseConstraint.create(engine, {
                mouse: mouse,
                constraint: { stiffness: 0.2, render: { visible: false } }
            });
            World.add(world, mouseConstraint);
            render.mouse = mouse;

            isFired = false;
            Events.on(engine, 'afterUpdate', function() {
                if (isFired) return;
                const distX = bird.position.x - CONFIG.slingshotX;
                const distY = bird.position.y - CONFIG.slingshotY;
                const distance = Math.sqrt(distX * distX + distY * distY);

                if (mouse.button === -1 && distance > 20 && bird.speed > 2) {
                    bird = null;
                    World.remove(world, sling);
                    isFired = true;
                }
            });

            Render.run(render);
            runner = Runner.create();
            Runner.run(runner, engine);
        }

        initGame();
        window.addEventListener('resize', () => initGame());
    </script>
</body>
</html>
