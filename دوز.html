<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ø§Ø²ÛŒ Ø¯ÙˆØ² Ø¨Ø§ Ø±Ø¨Ø§Øª | XO vs AI</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');

        body {
            margin: 0;
            padding: 0;
            background: #2c241b; 
            background-image: radial-gradient(#4e342e 10%, #2c241b 90%);
            font-family: 'Vazirmatn', Tahoma, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            color: white;
            user-select: none;
            overflow: hidden;
        }

        h1 {
            margin: 0 0 10px 0;
            font-size: 2.2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            color: #f1c40f;
        }

        .status-msg {
            background: rgba(0, 0, 0, 0.4);
            padding: 8px 25px;
            border-radius: 50px;
            margin-bottom: 15px;
            font-size: 1.1rem;
            border: 1px solid rgba(255,255,255,0.1);
            min-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.6);
            position: relative;
        }

        .cell {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3.5rem;
            font-weight: bold;
            transition: all 0.2s;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
        }

        .cell:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .cell.taken {
            cursor: not-allowed;
        }

        .cell.x { color: #ff4757; text-shadow: 0 0 15px rgba(255, 71, 87, 0.6); }
        .cell.o { color: #2ed573; text-shadow: 0 0 15px rgba(46, 213, 115, 0.6); }
        
        .cell.winner {
            background: #f1c40f !important;
            color: #fff !important;
            animation: pulse 0.8s infinite alternate;
        }

        .scores {
            display: flex;
            gap: 20px;
            margin-top: 25px;
            width: 100%;
            max-width: 320px;
            justify-content: center;
        }

        .score-box {
            text-align: center;
            background: rgba(0,0,0,0.3);
            padding: 10px 15px;
            border-radius: 15px;
            width: 100px;
            position: relative;
        }
        
        .score-box.active {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .score-box div:first-child { font-size: 0.85rem; color: #ccc; margin-bottom: 5px; }
        .score-box div:last-child { font-size: 1.6rem; font-weight: bold; }

        .btn-reset {
            margin-top: 25px;
            padding: 12px 35px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            font-family: 'Vazirmatn', sans-serif;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
            transition: transform 0.2s;
        }
        .btn-reset:active { transform: scale(0.95); }

        @keyframes pulse {
            from { transform: scale(1); box-shadow: 0 0 10px #f1c40f; }
            to { transform: scale(1.05); box-shadow: 0 0 20px #f1c40f; }
        }
    </style>
</head>
<body>

    <h1>Ø¯ÙˆØ² Ø¨Ø§ Ø±Ø¨Ø§Øª</h1>

    <div class="status-msg" id="statusMessage">Ù†ÙˆØ¨Øª Ø´Ù…Ø§Ø³Øª (X)</div>

    <div class="board" id="board">
        <!-- Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ -->
    </div>

    <div class="scores">
        <div class="score-box" id="p1-box" style="border-bottom: 3px solid #ff4757;">
            <div>Ø´Ù…Ø§ (X)</div>
            <div id="scorePlayer">0</div>
        </div>
        <div class="score-box" id="p2-box" style="border-bottom: 3px solid #2ed573;">
            <div>Ø±Ø¨Ø§Øª (O)</div>
            <div id="scoreAI">0</div>
        </div>
    </div>

    <button class="btn-reset" onclick="restartGame()">Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÛŒØ¯</button>

<script>
    const boardElement = document.getElementById('board');
    const statusMessage = document.getElementById('statusMessage');
    const scorePlayerEl = document.getElementById('scorePlayer');
    const scoreAIEl = document.getElementById('scoreAI');

    let board = ["", "", "", "", "", "", "", "", ""];
    let gameActive = true;
    let currentPlayer = "X"; // X Ù‡Ù…ÛŒØ´Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø§Ø³Øª
    let scores = { player: 0, ai: 0 };

    // Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø¯Ù‡
    const winConditions = [
        [0, 1, 2], [3, 4, 5], [6, 7, 8],
        [0, 3, 6], [1, 4, 7], [2, 5, 8],
        [0, 4, 8], [2, 4, 6]
    ];

    // Ø§ÛŒØ¬Ø§Ø¯ ØµÙØ­Ù‡ Ø¨Ø§Ø²ÛŒ
    function initBoard() {
        boardElement.innerHTML = '';
        board.forEach((cell, index) => {
            const cellDiv = document.createElement('div');
            cellDiv.classList.add('cell');
            cellDiv.setAttribute('data-index', index);
            cellDiv.addEventListener('click', handlePlayerMove);
            boardElement.appendChild(cellDiv);
        });
    }

    // Ø­Ø±Ú©Øª Ø¨Ø§Ø²ÛŒÚ©Ù†
    function handlePlayerMove(e) {
        const index = e.target.getAttribute('data-index');

        if (board[index] !== "" || !gameActive || currentPlayer !== "X") return;

        makeMove(index, "X");
        
        if (gameActive) {
            currentPlayer = "O";
            statusMessage.innerText = "Ø±Ø¨Ø§Øª Ø¯Ø± Ø­Ø§Ù„ ÙÚ©Ø± Ú©Ø±Ø¯Ù†...";
            // Ú©Ù…ÛŒ ØªØ§Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø·Ø¨ÛŒØ¹ÛŒâ€ŒØªØ± Ø´Ø¯Ù†
            setTimeout(makeComputerMove, 600);
        }
    }

    // Ù…Ù†Ø·Ù‚ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ (Ø±Ø¨Ø§Øª)
    function makeComputerMove() {
        if (!gameActive) return;

        let moveIndex;

        // 1. ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø¯ (Ø§Ú¯Ø± Ø¯Ùˆ ØªØ§ O Ø¯Ø§Ø±Ø¯ØŒ Ø³ÙˆÙ…ÛŒ Ø±Ø§ Ø¨Ú¯Ø°Ø§Ø±Ø¯)
        moveIndex = findBestMove("O");

        // 2. ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø¯ÙØ§Ø¹ (Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø¯Ùˆ ØªØ§ X Ø¯Ø§Ø±Ø¯ØŒ Ø¬Ù„ÙˆÛŒØ´ Ø±Ø§ Ø¨Ú¯ÛŒØ±Ø¯)
        if (moveIndex === -1) {
            moveIndex = findBestMove("X");
        }

        // 3. Ú¯Ø±ÙØªÙ† Ù…Ø±Ú©Ø² Ø§Ú¯Ø± Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯ (Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ù…Ù‡Ù…)
        if (moveIndex === -1 && board[4] === "") {
            moveIndex = 4;
        }

        // 4. Ø§Ù†ØªØ®Ø§Ø¨ ØªØµØ§Ø¯ÙÛŒ Ø§Ø² Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ
        if (moveIndex === -1) {
            const emptyIndices = board.map((val, idx) => val === "" ? idx : null).filter(val => val !== null);
            if (emptyIndices.length > 0) {
                const random = Math.floor(Math.random() * emptyIndices.length);
                moveIndex = emptyIndices[random];
            }
        }

        if (moveIndex !== -1) {
            makeMove(moveIndex, "O");
            if (gameActive) {
                currentPlayer = "X";
                statusMessage.innerText = "Ù†ÙˆØ¨Øª Ø´Ù…Ø§Ø³Øª (X)";
            }
        }
    }

    // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¨Ù‡ØªØ±ÛŒÙ† Ø­Ø±Ú©Øª (Ø­Ù…Ù„Ù‡ ÛŒØ§ Ø¯ÙØ§Ø¹)
    function findBestMove(playerSymbol) {
        for (let condition of winConditions) {
            const [a, b, c] = condition;
            const values = [board[a], board[b], board[c]];
            
            // Ø§Ú¯Ø± Ø¯Ùˆ Ø®Ø§Ù†Ù‡ Ù¾Ø± Ø´Ø¯Ù‡ ØªÙˆØ³Ø· ÛŒÚ© Ù†Ù…Ø§Ø¯ Ø®Ø§Øµ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ Ùˆ Ø³ÙˆÙ…ÛŒ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª
            if (values.filter(v => v === playerSymbol).length === 2 && values.includes("")) {
                if (board[a] === "") return a;
                if (board[b] === "") return b;
                if (board[c] === "") return c;
            }
        }
        return -1;
    }

    function makeMove(index, player) {
        board[index] = player;
        const cell = document.querySelector(`.cell[data-index='${index}']`);
        cell.innerText = player;
        cell.classList.add(player.toLowerCase(), 'taken');

        checkResult();
    }

    function checkResult() {
        let roundWon = false;
        let winningLine = [];

        for (let condition of winConditions) {
            const [a, b, c] = condition;
            if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                roundWon = true;
                winningLine = condition;
                break;
            }
        }

        if (roundWon) {
            endGame(winningLine);
            return;
        }

        if (!board.includes("")) {
            statusMessage.innerText = "Ø¨Ø§Ø²ÛŒ Ù…Ø³Ø§ÙˆÛŒ Ø´Ø¯! ðŸ˜";
            gameActive = false;
        }
    }

    function endGame(winningLine) {
        gameActive = false;
        const winner = board[winningLine[0]];
        statusMessage.innerHTML = winner === "X" ? "ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯ÛŒØ¯ ðŸŽ‰" : "Ø±Ø¨Ø§Øª Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯ ðŸ¤–";
        
        if (winner === "X") {
            scores.player++;
            scorePlayerEl.innerText = scores.player;
        } else {
            scores.ai++;
            scoreAIEl.innerText = scores.ai;
        }

        // Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ú©Ø±Ø¯Ù† Ø¨Ø±Ù†Ø¯Ù‡
        winningLine.forEach(index => {
            document.querySelector(`.cell[data-index='${index}']`).classList.add('winner');
        });
    }

    function restartGame() {
        board = ["", "", "", "", "", "", "", "", ""];
        gameActive = true;
        currentPlayer = "X";
        statusMessage.innerText = "Ù†ÙˆØ¨Øª Ø´Ù…Ø§Ø³Øª (X)";
        initBoard();
    }

    // Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ
    initBoard();

</script>
</body>
</html>
