<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¨Ø§Ø²ÛŒ ÙÙˆØªØ¨Ø§Ù„ Ú©ÙˆÚ†Ú© | Tiny Soccer</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #2c3e50;
            font-family: 'Tahoma', sans-serif;
            overflow: hidden;
            touch-action: none; /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø²ÙˆÙ… Ùˆ Ø§Ø³Ú©Ø±ÙˆÙ„ */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        #game-container {
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            border-radius: 15px;
            overflow: hidden;
        }
        canvas {
            display: block;
            background: #4CAF50; /* Ø³Ø¨Ø² Ú†Ù…Ù†ÛŒ */
            cursor: none; /* Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù…ÙˆØ³ Ø¯Ø§Ø®Ù„ Ø¨Ø§Ø²ÛŒ */
        }
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ù…Ù†ÙˆÙ‡Ø§ */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            text-align: center;
            color: white;
        }
        h1 {
            font-size: 40px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 #000;
            color: #f1c40f;
        }
        p { font-size: 18px; color: #ddd; margin-bottom: 30px; }
        .btn {
            background: #e67e22;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 22px;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Tahoma', sans-serif;
            box-shadow: 0 5px 0 #d35400;
            transition: transform 0.1s;
        }
        .btn:active {
            transform: translateY(5px);
            box-shadow: none;
        }
        .hidden { display: none !important; }
        
        /* ØªØ§Ø¨Ù„Ùˆ Ø§Ù…ØªÛŒØ§Ø² */
        #scoreboard {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.5);
            padding: 5px 20px;
            border-radius: 20px;
            color: white;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            gap: 20px;
            pointer-events: none;
            z-index: 5;
        }
        .score-blue { color: #3498db; }
        .score-red { color: #e74c3c; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="scoreboard">
        <span class="score-blue" id="scoreP">0</span>
        <span>-</span>
        <span class="score-red" id="scoreE">0</span>
    </div>

    <canvas id="gameCanvas"></canvas>

    <!-- Ù…Ù†ÙˆÛŒ Ø´Ø±ÙˆØ¹ -->
    <div id="startScreen" class="overlay">
        <img src="https://cdn-icons-png.flaticon.com/512/53/53283.png" width="80" style="margin-bottom:10px; filter: invert(1);">
        <h1>ÙÙˆØªØ¨Ø§Ù„ Ú©ÙˆÚ†Ú©</h1>
        <p>Ø¨Ø§ Ù…ÙˆØ³ ÛŒØ§ Ø§Ù†Ú¯Ø´Øª Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¢Ø¨ÛŒ Ø±Ø§ Ø­Ø±Ú©Øª Ø¯Ù‡ÛŒØ¯.<br>Ø§ÙˆÙ„ÛŒÙ† Ù†ÙØ±ÛŒ Ú©Ù‡ Û³ Ú¯Ù„ Ø¨Ø²Ù†Ø¯ Ø¨Ø±Ù†Ø¯Ù‡ Ø§Ø³Øª!</p>
        <button class="btn" onclick="startGame()">Ø¨Ø§Ø²ÛŒ Ú©Ù† â–¶</button>
    </div>

    <!-- Ù…Ù†ÙˆÛŒ Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ -->
    <div id="gameOverScreen" class="overlay hidden">
        <h1 id="winnerText">Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ</h1>
        <button class="btn" onclick="resetGame()">Ø¨Ø§Ø²ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ â†º</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // ØªÙ†Ø¸ÛŒÙ… Ø³Ø§ÛŒØ² Ø¨Ø§Ø²ÛŒ
    const GAME_WIDTH = 800;
    const GAME_HEIGHT = 500;
    
    // ØªØºÛŒÛŒØ± Ø³Ø§ÛŒØ² Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ
    function resize() {
        let scale = Math.min(window.innerWidth / GAME_WIDTH, window.innerHeight / GAME_HEIGHT);
        if (scale > 1) scale = 1; // Ø¨Ø²Ø±Ú¯ØªØ± Ø§Ø² Ø­Ø¯ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ù†Ø´ÙˆØ¯
        
        canvas.width = GAME_WIDTH;
        canvas.height = GAME_HEIGHT;
        
        canvas.style.width = (GAME_WIDTH * scale) + 'px';
        canvas.style.height = (GAME_HEIGHT * scale) + 'px';
    }
    window.addEventListener('resize', resize);
    resize();

    // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
    let gameState = 'MENU'; // MENU, PLAYING, GOAL, GAMEOVER
    let scores = { player: 0, enemy: 0 };
    const WIN_SCORE = 3;

    // Ø§Ø´ÛŒØ§Ø¡ Ø¨Ø§Ø²ÛŒ
    const ball = { x: GAME_WIDTH/2, y: GAME_HEIGHT/2, r: 12, vx: 0, vy: 0, friction: 0.98, speed: 0 };
    const player = { x: 100, y: GAME_HEIGHT/2, r: 25, color: '#3498db', speed: 5 };
    const enemy = { x: GAME_WIDTH - 100, y: GAME_HEIGHT/2, r: 25, color: '#e74c3c', speed: 3.5 }; // Ú©Ù…ÛŒ Ú©Ù†Ø¯ØªØ± Ø§Ø² Ø¨Ø§Ø²ÛŒÚ©Ù†
    
    const goalHeight = 140;
    const goalWidth = 40;

    // ÙˆØ±ÙˆØ¯ÛŒ Ù…ÙˆØ³/ØªØ§Ú†
    let mouseX = 100;
    let mouseY = GAME_HEIGHT/2;

    function handleInput(x, y) {
        // ØªØ¨Ø¯ÛŒÙ„ Ù…Ø®ØªØµØ§Øª ØµÙØ­Ù‡ Ø¨Ù‡ Ù…Ø®ØªØµØ§Øª Ú©Ø§Ù†ÙˆØ§Ø³
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;

        mouseX = (x - rect.left) * scaleX;
        mouseY = (y - rect.top) * scaleY;
    }

    canvas.addEventListener('mousemove', e => handleInput(e.clientX, e.clientY));
    canvas.addEventListener('touchmove', e => {
        e.preventDefault();
        handleInput(e.touches[0].clientX, e.touches[0].clientY);
    }, {passive: false});

    // Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ
    function startGame() {
        document.getElementById('startScreen').classList.add('hidden');
        document.getElementById('gameOverScreen').classList.add('hidden');
        resetMatch();
        gameState = 'PLAYING';
        loop();
    }

    // Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„
    function resetMatch() {
        scores.player = 0;
        scores.enemy = 0;
        updateScoreBoard();
        resetPositions();
    }

    // Ø±ÛŒØ³Øª Ø¨Ø¹Ø¯ Ø§Ø² Ú¯Ù„
    function resetPositions() {
        ball.x = GAME_WIDTH / 2;
        ball.y = GAME_HEIGHT / 2;
        ball.vx = 0;
        ball.vy = 0;
        
        player.x = 150;
        player.y = GAME_HEIGHT / 2;
        
        enemy.x = GAME_WIDTH - 150;
        enemy.y = GAME_HEIGHT / 2;
        
        mouseX = player.x; // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø±Ø´ Ù†Ø§Ú¯Ù‡Ø§Ù†ÛŒ
        mouseY = player.y;
    }

    function updateScoreBoard() {
        document.getElementById('scoreP').innerText = scores.player;
        document.getElementById('scoreE').innerText = scores.enemy;
    }

    // --- Ù…Ù†Ø·Ù‚ ÙÛŒØ²ÛŒÚ© Ùˆ Ø¨Ø±Ø®ÙˆØ±Ø¯ ---
    
    function distance(c1, c2) {
        return Math.sqrt((c1.x - c2.x)**2 + (c1.y - c2.y)**2);
    }

    function checkCollision(c1, c2) {
        let dist = distance(c1, c2);
        if (dist < c1.r + c2.r) {
            // Ø²Ø§ÙˆÛŒÙ‡ Ø¨Ø±Ø®ÙˆØ±Ø¯
            let angle = Math.atan2(c1.y - c2.y, c1.x - c2.x);
            let force = 8; // Ù‚Ø¯Ø±Øª Ø´ÙˆØª

            // Ù¾Ø±ØªØ§Ø¨ ØªÙˆÙ¾
            ball.vx = Math.cos(angle) * force;
            ball.vy = Math.sin(angle) * force;

            // ØµØ¯Ø§ÛŒ Ø¨Ø±Ø®ÙˆØ±Ø¯ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ - ÙˆÛŒÚ˜ÙˆØ§Ù„)
            return true;
        }
        return false;
    }

    function update() {
        if (gameState !== 'PLAYING') return;

        // 1. Ø­Ø±Ú©Øª Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¨Ù‡ Ø³Ù…Øª Ù…ÙˆØ³
        let dx = mouseX - player.x;
        let dy = mouseY - player.y;
        let dist = Math.sqrt(dx*dx + dy*dy);
        
        if (dist > 5) {
            player.x += (dx / dist) * player.speed;
            player.y += (dy / dist) * player.speed;
        }

        // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¯Ø± Ø²Ù…ÛŒÙ†
        player.x = Math.max(player.r, Math.min(GAME_WIDTH - player.r, player.x));
        player.y = Math.max(player.r, Math.min(GAME_HEIGHT - player.r, player.y));

        // 2. Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ (Enemy AI)
        // Ø§Ú¯Ø± ØªÙˆÙ¾ Ø³Ù…Øª Ø®ÙˆØ¯ÛŒ Ø§Ø³ØªØŒ Ø­Ù…Ù„Ù‡ Ú©Ù†
        // Ø§Ú¯Ø± ØªÙˆÙ¾ Ø³Ù…Øª Ø­Ø±ÛŒÙ Ø§Ø³ØªØŒ Ø¯ÙØ§Ø¹ Ú©Ù†
        let targetX = ball.x;
        let targetY = ball.y;

        // Ù…Ù†Ø·Ù‚ Ø³Ø§Ø¯Ù‡ Ø¯ÙØ§Ø¹ÛŒ: Ø¨ÛŒÙ† ØªÙˆÙ¾ Ùˆ Ø¯Ø±ÙˆØ§Ø²Ù‡ Ø®ÙˆØ¯ÛŒ Ø¨Ù…Ø§Ù†
        if (ball.x < GAME_WIDTH / 2) {
            targetX = GAME_WIDTH - 100; // Ø¹Ù‚Ø¨ Ø¨Ù…Ø§Ù†
            targetY = Math.max(GAME_HEIGHT/2 - 100, Math.min(GAME_HEIGHT/2 + 100, ball.y)); // Ø¯Ù†Ø¨Ø§Ù„ Ú©Ø±Ø¯Ù† Y ØªÙˆÙ¾ Ø¨Ø§ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª
        }

        let edx = targetX - enemy.x;
        let edy = targetY - enemy.y;
        let edist = Math.sqrt(edx*edx + edy*edy);

        if (edist > 5) {
            enemy.x += (edx / edist) * enemy.speed;
            enemy.y += (edy / edist) * enemy.speed;
        }
        
        // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø±Ø¨Ø§Øª
        enemy.x = Math.max(enemy.r, Math.min(GAME_WIDTH - enemy.r, enemy.x));
        enemy.y = Math.max(enemy.r, Math.min(GAME_HEIGHT - enemy.r, enemy.y));

        // 3. ÙÛŒØ²ÛŒÚ© ØªÙˆÙ¾
        ball.x += ball.vx;
        ball.y += ball.vy;
        ball.vx *= ball.friction;
        ball.vy *= ball.friction;

        // Ø¨Ø±Ø®ÙˆØ±Ø¯ ØªÙˆÙ¾ Ø¨Ø§ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†
        checkCollision(ball, player);
        checkCollision(ball, enemy);

        // Ø¨Ø±Ø®ÙˆØ±Ø¯ ØªÙˆÙ¾ Ø¨Ø§ Ø¯ÛŒÙˆØ§Ø±Ù‡Ø§ (Ø¨Ø§Ù„Ø§ Ùˆ Ù¾Ø§ÛŒÛŒÙ†)
        if (ball.y - ball.r < 0 || ball.y + ball.r > GAME_HEIGHT) {
            ball.vy = -ball.vy;
            ball.y = Math.max(ball.r, Math.min(GAME_HEIGHT - ball.r, ball.y));
        }

        // Ø¨Ø±Ø®ÙˆØ±Ø¯ ØªÙˆÙ¾ Ø¨Ø§ Ø¯ÛŒÙˆØ§Ø±Ù‡Ø§ÛŒ Ú†Ù¾ Ùˆ Ø±Ø§Ø³Øª (Ø¨Ù‡ Ø¬Ø² Ø¯Ø±ÙˆØ§Ø²Ù‡)
        // Ø¯Ø±ÙˆØ§Ø²Ù‡ Ú†Ù¾ (Ø¨Ø§Ø²ÛŒÚ©Ù†)
        if (ball.x - ball.r < 0) {
            if (ball.y > (GAME_HEIGHT - goalHeight)/2 && ball.y < (GAME_HEIGHT + goalHeight)/2) {
                // Ú¯Ù„ Ø¨Ø±Ø§ÛŒ Ø­Ø±ÛŒÙ!
                scores.enemy++;
                goalScored('Ù‚Ø±Ù…Ø²');
            } else {
                ball.vx = -ball.vx;
                ball.x = ball.r;
            }
        }
        // Ø¯Ø±ÙˆØ§Ø²Ù‡ Ø±Ø§Ø³Øª (Ø­Ø±ÛŒÙ)
        if (ball.x + ball.r > GAME_WIDTH) {
            if (ball.y > (GAME_HEIGHT - goalHeight)/2 && ball.y < (GAME_HEIGHT + goalHeight)/2) {
                // Ú¯Ù„ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§!
                scores.player++;
                goalScored('Ø¢Ø¨ÛŒ');
            } else {
                ball.vx = -ball.vx;
                ball.x = GAME_WIDTH - ball.r;
            }
        }
    }

    function goalScored(who) {
        updateScoreBoard();
        gameState = 'GOAL';
        
        // Ú†Ú© Ú©Ø±Ø¯Ù† Ø¨Ø±Ù†Ø¯Ù‡
        if (scores.player >= WIN_SCORE) {
            endGame('ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯ÛŒØ¯ ğŸ†');
        } else if (scores.enemy >= WIN_SCORE) {
            endGame('Ø¨Ø§Ø®ØªÛŒØ¯! Ø±Ø¨Ø§Øª Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯ ğŸ¤–');
        } else {
            // Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø§Ø²ÛŒ Ø¨Ø¹Ø¯ Ø§Ø² 2 Ø«Ø§Ù†ÛŒÙ‡
            setTimeout(() => {
                resetPositions();
                gameState = 'PLAYING';
            }, 1500);
        }
    }

    function endGame(msg) {
        setTimeout(() => {
            document.getElementById('winnerText').innerText = msg;
            document.getElementById('gameOverScreen').classList.remove('hidden');
            gameState = 'GAMEOVER';
        }, 500);
    }

    function resetGame() {
        document.getElementById('gameOverScreen').classList.add('hidden');
        resetMatch();
        gameState = 'PLAYING';
    }

    // --- Ø±Ø³Ù… Ø¨Ø§Ø²ÛŒ ---
    
    function drawField() {
        // Ú†Ù…Ù†
        ctx.fillStyle = '#4CAF50';
        ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
        
        // Ø®Ø· Ú©Ø´ÛŒ Ø²Ù…ÛŒÙ†
        ctx.strokeStyle = 'rgba(255,255,255,0.7)';
        ctx.lineWidth = 4;

        // ÙˆØ³Ø· Ø²Ù…ÛŒÙ†
        ctx.beginPath();
        ctx.moveTo(GAME_WIDTH/2, 0);
        ctx.lineTo(GAME_WIDTH/2, GAME_HEIGHT);
        ctx.stroke();

        ctx.beginPath();
        ctx.arc(GAME_WIDTH/2, GAME_HEIGHT/2, 70, 0, Math.PI*2);
        ctx.stroke();

        // Ù…Ø­ÙˆØ·Ù‡ Ø¬Ø±ÛŒÙ…Ù‡ Ú†Ù¾
        ctx.strokeRect(0, (GAME_HEIGHT - 250)/2, 120, 250);
        // Ù…Ø­ÙˆØ·Ù‡ Ø¬Ø±ÛŒÙ…Ù‡ Ø±Ø§Ø³Øª
        ctx.strokeRect(GAME_WIDTH - 120, (GAME_HEIGHT - 250)/2, 120, 250);

        // Ø¯Ø±ÙˆØ§Ø²Ù‡ Ù‡Ø§ (ØªÙˆ Ø±ÙØªÙ‡)
        ctx.fillStyle = 'rgba(0,0,0,0.2)';
        ctx.fillRect(0, (GAME_HEIGHT - goalHeight)/2, 10, goalHeight); // Ú†Ù¾
        ctx.fillRect(GAME_WIDTH - 10, (GAME_HEIGHT - goalHeight)/2, 10, goalHeight); // Ø±Ø§Ø³Øª
    }

    function drawCircle(obj, stroke) {
        ctx.beginPath();
        ctx.arc(obj.x, obj.y, obj.r, 0, Math.PI*2);
        ctx.fillStyle = obj.color;
        ctx.fill();
        ctx.strokeStyle = stroke || 'rgba(0,0,0,0.3)';
        ctx.lineWidth = 3;
        ctx.stroke();
    }

    function drawBall() {
        ctx.save();
        ctx.translate(ball.x, ball.y);
        // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú†Ø±Ø®Ø´ ØªÙˆÙ¾ (Ø³Ø§Ø¯Ù‡)
        // ctx.rotate(Date.now() / 100); 
        
        ctx.beginPath();
        ctx.arc(0, 0, ball.r, 0, Math.PI*2);
        ctx.fillStyle = 'white';
        ctx.fill();
        ctx.strokeStyle = 'black';
        ctx.lineWidth = 2;
        ctx.stroke();

        // Ø·Ø±Ø­ Ø±ÙˆÛŒ ØªÙˆÙ¾
        ctx.beginPath();
        ctx.arc(0, 0, ball.r/2, 0, Math.PI*2);
        ctx.fillStyle = 'black';
        ctx.fill();
        
        ctx.restore();
    }

    function drawGoalMessage() {
        if (gameState === 'GOAL') {
            ctx.fillStyle = 'rgba(0,0,0,0.5)';
            ctx.fillRect(0, GAME_HEIGHT/2 - 60, GAME_WIDTH, 120);
            
            ctx.fillStyle = '#f1c40f';
            ctx.font = 'bold 80px Tahoma';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('GOAL!!!', GAME_WIDTH/2, GAME_HEIGHT/2);
        }
    }

    function loop() {
        ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
        
        drawField();
        
        // Ø±Ø³Ù… Ø§Ø´ÛŒØ§
        drawCircle(player, '#154360'); // Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¢Ø¨ÛŒ
        drawCircle(enemy, '#78281f');  // Ø±Ø¨Ø§Øª Ù‚Ø±Ù…Ø²
        drawBall();

        drawGoalMessage();

        update();
        
        if (gameState !== 'GAMEOVER') {
            requestAnimationFrame(loop);
        }
    }
    
    // Ø±Ù†Ø¯Ø± Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯Ù‡ Ø´Ø¯Ù† Ø²Ù…ÛŒÙ† Ù‚Ø¨Ù„ Ø§Ø² Ø²Ø¯Ù† Ø¯Ú©Ù…Ù‡
    drawField();
    drawCircle(player, '#154360');
    drawCircle(enemy, '#78281f');
    drawBall();

</script>
</body>
</html>
